{"version":3,"sources":["../src/cell.js"],"names":[],"mappings":"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","file":"cell.js","sourcesContent":["Polymer({\r\n  is: 'ms-cell',\r\n  properties: {\r\n    cell: Object,\r\n    color: {\r\n      type: String,\r\n      notify: true\r\n    },\r\n    revealed: {\r\n      type: Boolean,\r\n      value: false,\r\n      observer: 'revealedChanged'\r\n    },\r\n    hide: {\r\n      type: Boolean,\r\n      computed: 'computedHide(cell.flagged, revealed)'\r\n    },\r\n    showFlag: { type: Boolean, value: false },\r\n    displayVal: {\r\n      type: String,\r\n      computed: 'computedDisplayVal(cell.flagged, revealed)'\r\n    }\r\n  },\r\n  observers: [\r\n    'colorChanged(cell.color)'\r\n  ],\r\n  colorChanged() {\r\n    this.color = `color: ${this.cell.color()}`\r\n  },\r\n  computedHide(flagged, revealed) {\r\n    return !flagged && !revealed;\r\n  },\r\n  computedDisplayVal(flagged, revealed) {\r\n    if(flagged && !revealed) {\r\n      return 'F';\r\n    } else {\r\n      return this.cell.revealedVal();\r\n    }\r\n  },\r\n  ready() {\r\n    this.color = 'color:' + this.cell.color();\r\n    this.bindPropagate();\r\n  },\r\n  bindPropagate() {\r\n    /**\r\n     * Recursively reveal a 0 risk cell's neighbors.\r\n     * And check for wins if revealing a risky cell.\r\n     */\r\n    let propagate = () => {\r\n      // only need to fire reveal-neighbors once\r\n      if(this.revealed && !this.cell.mine) {\r\n        this.removeEventListener('webkitAnimationEnd', propagate);\r\n        this.removeEventListener('MSAnimationEnd', propagate);\r\n        this.removeEventListener('animationend', propagate);\r\n        if(this.cell.risk === 0) {\r\n          this.fire('reveal-neighbors');\r\n        } else {\r\n          this.fire('check-win');\r\n        }\r\n      }\r\n    };\r\n    this.addEventListener('webkitAnimationEnd', propagate);\r\n    this.addEventListener('MSAnimationEnd', propagate);\r\n    this.addEventListener('animationend', propagate);\r\n  },\r\n  revealedChanged() {\r\n    if(this.revealed) {\r\n      this.cell.revealed = true;\r\n      Polymer.dom(this).classList.add(this.cell.mine ? 'explode' : 'revealed');\r\n    }\r\n  },\r\n  reveal(event, detail, sender) {\r\n    // do nothing if it's already revealed or if it's been flagged.\r\n    if(this.revealed || this.cell.flagged) {\r\n      return;\r\n    }\r\n    this.revealed = true;\r\n    if(this.cell.mine) {\r\n      this.fire('explosion');\r\n    }\r\n  },\r\n  /**\r\n   * Event handler for context menu clicks (flagging mines)\r\n   */\r\n  flag(e) {\r\n    e.preventDefault();\r\n    if(this.revealed) {\r\n      return;\r\n    } else {\r\n      let flag = this.$$('#flag');\r\n      if(!this.cell.flagged) {\r\n        Polymer.dom(flag).classList.add('flagged', 'drop-flag');\r\n        this.cell.flagged = this.showFlag = true;\r\n        this.color = 'color:orange';\r\n        this.fire('flagged', 1);\r\n      } else {\r\n        let removeFlag = () => {\r\n          this.cell.flagged = this.showFlag = false;\r\n          Polymer.dom(flag).classList.remove('flagged', 'pickup-flag');\r\n          this.color = 'color:' + this.cell.color();\r\n          this.fire('flagged', -1);\r\n          this.removeEventListener('webkitAnimationEnd', removeFlag);\r\n          this.removeEventListener('MSAnimationEnd', removeFlag);\r\n          this.removeEventListener('animationend', removeFlag);\r\n        };\r\n        this.addEventListener('webkitAnimationEnd', removeFlag);\r\n        this.addEventListener('MSAnimationEnd', removeFlag);\r\n        this.addEventListener('animationend', removeFlag);\r\n        /**\r\n         * Animate the flag pickup:\r\n         * Removing a class with animation (possible specific to reverse animation)\r\n         * and then adding a class with animation on different cycles (eventloops)\r\n         * to prevent flicker and conflicting animation rules.\r\n         */\r\n        Polymer.dom(flag).classList.remove('drop-flag');\r\n        setTimeout(() => {\r\n          Polymer.dom(flag).classList.add('pickup-flag');\r\n        }, 0);\r\n      }\r\n    }\r\n  },\r\n\r\n  reset() {\r\n    // hide\r\n    this.revealed = false;\r\n    Polymer.dom(this).classList.remove('explode', 'revealed');\r\n    // unflag\r\n    this.cell.flagged = this.showFlag = false;\r\n    let flag = this.$$('#flag');\r\n    Polymer.dom(flag).classList.remove('flagged', 'drop-flag');\r\n    // rebind event listeners\r\n    this.bindPropagate();\r\n  }\r\n});\r\n"]}