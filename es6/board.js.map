{"version":3,"sources":["src/board.js"],"names":[],"mappings":"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","file":"src/board.js","sourcesContent":["'use strict';\nPolymer({\n  is: 'ms-board',\n  properties: {\n    rows:           { type: Number, value: 15 },\n    columns:        { type: Number, value: 15 },\n    mines:          { type: Number, value: 15 },\n    flagCount:      { type: Number, value: 0 },\n    gameOver:       { type: Boolean, value: false },\n    win:            { type: Boolean, value: false },\n    doneExploding:  { type: Boolean, value: false },\n    grid: Object,\n\n    _gameEndMessage: {\n      type: String, computed: 'computedEndMessage(win)'\n    },\n    _gameEndCss: {\n      type: String, computed: 'computedEndCss(doneExploding, win)'\n    },\n    _gameEndColor: {\n      type: String, computed: 'computedEndColor(win)'\n    }\n  },\n  computedEndMessage(win) {\n    return win ? 'YOU WIN' : 'GAME OVER';\n  },\n  computedEndCss(doneExploding, win) {\n    return (doneExploding || win ? 'show' : '') + ' horizontal center-justified layout center';    \n  },\n  computedEndColor(win) {\n    return 'color:' + (win ? 'green' : 'red');\n  },\n  /**\n   * IMPORTANT: Attributes configured via an element e.g. <x-foo name=\"bar\"></x-foo>\n   * are not available in the `created`lifecycle method. They first become available\n   * in the `ready` lifecycle method.\n   */\n  ready() {\n    this.grid = new MSPolymer.Grid(this.rows, this.columns, this.mines);\n  },\n  flaggedHandler(e) {\n    this.flagCount += e.detail; // 1 or -1\n    this.checkWin();\n  },\n  checkWin() {\n    this.win = this.grid.hasWon();\n    if (this.win) {\n      this.gameOver = true;\n    }\n  },\n  /**\n   * Recursively self reveals cells as 0 risk cells are revealed.\n   * Recursion is oddly handled through animation. See `propagate` on ms-cell.html.\n   */\n  revealNeighbors(e) {\n    let position = e.srcElement.id.split('_').slice(-2); // get grid position from id\n    let row = parseInt(position[0]);\n    let col = parseInt(position[1]);\n    let revealNeighbor = this.grid.forEachSurroudingCell(row, col);\n    revealNeighbor((r, c) => {\n      /**\n       * Common Polymer gotcha:\n       * Automatic node finding only works 1 level deep in the shadow DOM tree.\n       * Anything deeper can be accessed by using `querySelector` on an\n       * automatically found node.\n       */\n      let neighbor = Polymer.dom(this.$.board).querySelector('#cid_' + r + '_' + c);\n      if (!neighbor.cell.flagged) {\n        neighbor.revealed = true; // recursion via data-binding\n      }\n    }, this);\n  },\n  /**\n   * As soon as any mine explodes, this method fires off the rest\n   * to make it a board-wide explosion.\n   */\n  createExplosion(e) {\n    this.gameOver = true;\n\n    let mineCellIds = this.grid.mineArray.map((id) => '#' + id).join(',');\n    let minesArr = Array.from(Polymer.dom(this.$.board).querySelectorAll(mineCellIds));\n    minesArr = shuffleArray(minesArr); // shuffle the mines for a random explosion effect\n\n    // know when to show the game over message - after we're done exploding\n    let explodedCount = 0;\n    let explode = (e) => {\n      if (e.animationName === 'explode') {\n        explodedCount++;\n        if (explodedCount === this.mines - this.flagCount) {\n          this.doneExploding = true\n        }\n      }\n    };\n    this.addEventListener('webkitAnimationEnd', explode);\n    this.addEventListener('MSAnimationEnd', explode);\n    this.addEventListener('animationend', explode);\n\n    minesArr.forEach((cell, i) => {\n      setTimeout(() => {\n        if (!cell.cell.flagged) {\n          cell.revealed = true; // explode unflagged mines\n        }\n      }, i % 2 === 0 ? i * 15 : i * 12);\n    });\n  }\n});\n\n/*\nUtils\n */\nfunction shuffleArray(array) {\n  for (let i = array.length - 1; i > 0; i--) {\n    let j = Math.floor(Math.random() * (i + 1));\n    let temp = array[i];\n    array[i] = array[j];\n    array[j] = temp;\n  }\n  return array;\n}\n"]}